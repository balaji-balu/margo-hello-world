package trigger

import (
    "fmt"
    "os"
    "github.com/balaji/hello/pkg/config"
)

func New(cfg config.Config) Trigger {
    switch cfg.Trigger.Type {
    case "poll":
        return &PollTrigger{
            RepoOwner: cfg.Trigger.RepoOwner,
            RepoName:  cfg.Trigger.RepoName,
            Path:      cfg.Trigger.YamlPath,
            Token:     os.Getenv(cfg.Trigger.TokenEnv),
            Interval:  cfg.Trigger.Interval,
        }
    case "event":
        return &EventTrigger{
            BrokerURL: cfg.Broker.URL,
            Topic:     cfg.Broker.Topic,
        }
    case "gitops":
        return &GitOpsTrigger{}
    default:
        panic(fmt.Sprintf("unsupported trigger type: %s", cfg.Trigger.Type))
    }
}
